generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  SUPER_ADMIN
  ADMIN
  USER
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String?
  role      Role     @default(USER)
  image     String?
  partnerName String?
  phone     String?
  weddingDate DateTime?
  venueId   String?
  venue     Venue?   @relation(fields: [venueId], references: [id])
  events    Event[]  // Relation to events (for Clients)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Venue {
  id        String   @id @default(cuid())
  name      String
  operators User[]
  events    Event[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Event {
  id             String          @id @default(cuid())
  name           String
  date           DateTime
  budget         Float?
  venueId        String
  venue          Venue           @relation(fields: [venueId], references: [id])
  clientId       String
  client         User            @relation(fields: [clientId], references: [id])
  tasks          Task[]
  guests         Guest[]
  budgetItems    BudgetItem[]
  vendors        Vendor[]
  tables         Table[]
  moodboardItems MoodboardItem[]
  playlistSongs  PlaylistSong[]
  giftItems      GiftItem[]
  timelineEvents TimelineEvent[]
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
}

model TimelineEvent {
  id          String   @id @default(cuid())
  eventId     String
  event       Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  time        String   // Format: "14:30"
  title       String
  description String?
  duration    Int?     // Duration in minutes
  location    String?
  category    String   @default("OTHER") // CEREMONY, RECEPTION, PHOTOS, etc.
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([eventId])
}

model Task {
  id          String   @id @default(cuid())
  description String
  isCompleted Boolean  @default(false)
  category    String   @default("GENERAL") // Timeline category
  order       Int      @default(0) // Order within category
  dueDate     DateTime? // When the task should be completed
  eventId     String
  event       Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([eventId])
}

enum VendorCategory {
  VENUE
  CATERING
  PHOTOGRAPHY
  VIDEOGRAPHY
  FLORIST
  MUSIC_DJ
  MUSIC_BAND
  HAIR_MAKEUP
  DRESS
  SUIT
  CAKE
  DECORATION
  TRANSPORTATION
  INVITATIONS
  ENTERTAINMENT
  OTHER
}

enum VendorStatus {
  RESEARCHING
  CONTACTED
  QUOTE_RECEIVED
  BOOKED
  CONFIRMED
  COMPLETED
  CANCELLED
}

model Vendor {
  id              String         @id @default(cuid())
  eventId         String
  event           Event          @relation(fields: [eventId], references: [id], onDelete: Cascade)
  category        VendorCategory
  companyName     String
  contactPerson   String?
  email           String?
  phone           String?
  website         String?
  status          VendorStatus   @default(RESEARCHING)
  quotedPrice     Float?
  finalPrice      Float?
  depositPaid     Float          @default(0)
  contractSigned  Boolean        @default(false)
  contractUrl     String?        // URL to uploaded contract
  notes           String?
  rating          Int?           // 1-5 stars
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
}


enum RSVPStatus {
  PENDING
  ACCEPTED
  DECLINED
}

enum MealPreference {
  STANDARD
  VEGETARIAN
  VEGAN
  GLUTEN_FREE
  HALAL
  KOSHER
  OTHER
}

model Guest {
  id              String         @id @default(cuid())
  name            String
  email           String?
  phone           String?
  rsvpStatus      RSVPStatus     @default(PENDING)
  mealPreference  MealPreference @default(STANDARD)
  dietaryNotes    String?        // Allergies, special requirements
  tableId         String?
  table           Table?         @relation(fields: [tableId], references: [id])
  seatNumber      Int?
  tableGroup      String?        // e.g., "Family", "Friends", "Work"
  isPlusOne       Boolean        @default(false)
  plusOneOf       String?        // Name of the main guest
  hasChildren     Boolean        @default(false)
  childrenCount   Int            @default(0)
  notes           String?
  eventId         String
  event           Event          @relation(fields: [eventId], references: [id], onDelete: Cascade)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
}


enum BudgetCategory {
  VENUE
  CATERING
  PHOTOGRAPHY
  VIDEOGRAPHY
  FLOWERS
  MUSIC
  DRESS
  SUIT
  RINGS
  INVITATIONS
  DECORATION
  TRANSPORTATION
  OTHER
}

enum PaymentStatus {
  PENDING
  PARTIAL
  PAID
}

model Table {
  id        String   @id @default(cuid())
  name      String
  shape     String   @default("RECTANGLE")
  capacity  Int
  x         Float    @default(0)
  y         Float    @default(0)
  rotation  Float    @default(0)
  eventId   String
  event     Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  guests    Guest[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([eventId])
}

model MoodboardItem {
  id        String   @id @default(cuid())
  imageUrl  String
  notes     String?
  category  String   @default("GENERAL")
  color     String?
  eventId   String
  event     Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([eventId])
}

model BudgetItem {
  id            String         @id @default(cuid())
  eventId       String
  event         Event          @relation(fields: [eventId], references: [id], onDelete: Cascade)
  category      BudgetCategory
  name          String
  plannedAmount Float
  actualAmount  Float          @default(0)
  paidAmount    Float          @default(0)
  paymentStatus PaymentStatus  @default(PENDING)
  vendor        String?
  notes         String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
}

model PlaylistSong {
  id          String   @id @default(cuid())
  title       String
  artist      String
  category    String   @default("GENERAL") // CEREMONY, RECEPTION, DANCE, DINNER
  notes       String?
  requestedBy String?
  eventId     String
  event       Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([eventId])
}

model GiftItem {
  id          String   @id @default(cuid())
  name        String
  description String?
  price       Float?
  url         String?
  imageUrl    String?
  category    String   @default("GENERAL") // HOME, KITCHEN, EXPERIENCE, CASH
  isPurchased Boolean  @default(false)
  purchasedBy String?
  eventId     String
  event       Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([eventId])
}

